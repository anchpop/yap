This is the difficult part