I think I figured out how to solve all the problems.